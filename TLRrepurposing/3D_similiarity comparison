#importing commands for manipulation of files in folder (e.g. getting the list of names)
from os import listdir
from os.path import isfile
from os.path import join
#importing the commands for calculating and usage of 3D fingerprints
from e3fp.fingerprint.db import FingerprintDatabase
from e3fp.fingerprint.fprint import Fingerprint
from e3fp.fingerprint.metrics import tanimoto, dice, cosine
#importing pandas for manipulation of matrix similiar to data frames
import pandas as pd
#for histogram generation and manipulation
import seaborn
import matplotlib.mlab as mlab
import matplotlib.pyplot as plt


#get the file names in the folder with fingerprints
onlyFiles = [f for f in listdir("/home/dsribar/Documents/tlr8/Repurposing/Fingerprints_CS") if
             isfile(join("/home/dsribar/Documents/tlr8/Repurposing/Fingerprints_CS", f))]
onlyNames = [s.strip('.fps.bz2') for s in onlyFiles]
print(onlyFiles)
print(onlyNames)

#Calculate pairwise 3D similiarity matrix for all the fingerprints in the folder- use the best tanimoto coeffients between pairs all of the generation conformation
#between two molecules and plot the corresponding heatmap

comparisonMatrix3D = []

for i in range(0, len(onlyFiles)):
    row = []
    db1 = FingerprintDatabase.load("/home/dsribar/Documents/tlr8/Repurposing/Fingerprints_CS/" + onlyFiles[i])
    for j in range(0, len(onlyFiles)):
        db2 = FingerprintDatabase.load("/home/dsribar/Documents/tlr8/Repurposing/Fingerprints_CS/" + onlyFiles[j])
        similiarity=tanimoto(db1, db2)
        if db1==db2:
             row.append(round(similiarity.max(), 2))
        else:
            row.append(round(similiarity.max(), 2))
    comparisonMatrix3D.append(row)

from matplotlib import pyplot as plt
import numpy as np


comparisonMatrix3D = pd.DataFrame(comparisonMatrix3D)
comparisonMatrix3D.columns = onlyNames
comparisonMatrix3D.index = onlyNames

seaborn.heatmap(comparisonMatrix3D, cmap="Blues", annot=True)
plt.yticks(rotation=0)
plt.xticks(rotation=60)
plt.title("E3FP")
plt.show()





